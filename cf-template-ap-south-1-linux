{
    "AWSTemplateFormatVersion": "2010-09-09",
    "Resources": {
        "MyVPC": {
            "Type": "AWS::EC2::VPC",
            "Properties": {
                "CidrBlock": "10.0.0.0/16",
                "EnableDnsSupport": "false",
                "EnableDnsHostnames": "true",
                "InstanceTenancy": "default"
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "a268680a-d686-4537-98ec-f0acb5afa4b2"
                }
            }
        },
        "PublicSubnet01": {
            "Type": "AWS::EC2::Subnet",
            "Properties": {
                "VpcId": {
                    "Ref": "MyVPC"
                },
                "CidrBlock": "10.0.0.0/24",
                "AvailabilityZone": "ap-south-1a",
                "MapPublicIpOnLaunch": "true",
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "PublicSubnet1"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "599fbfdf-f188-4ff4-88d4-3da7636ac8b8"
                }
            }
        },
        "PrivateSubnet01": {
            "Type": "AWS::EC2::Subnet",
            "Properties": {
                "VpcId": {
                    "Ref": "MyVPC"
                },
                "CidrBlock": "10.0.2.0/24",
                "AvailabilityZone": "ap-south-1a",
                "MapPublicIpOnLaunch": "false",
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "PrivateSubnet1"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "25fea4b4-1880-46c2-8d7d-404a9aa2612b"
                }
            }
        },
        "MyIGW": {
            "Type": "AWS::EC2::InternetGateway",
            "Properties": {},
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "217af7ea-356b-4df5-b965-af3959dd5ff1"
                }
            }
        },
        "EC2VPCG2S1W0": {
            "Type": "AWS::EC2::VPCGatewayAttachment",
            "Properties": {
                "InternetGatewayId": {
                    "Ref": "MyIGW"
                },
                "VpcId": {
                    "Ref": "MyVPC"
                }
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "89e5ffc2-86b7-4525-b383-fcd2b451323e"
                }
            }
        },
        "PublicRouteTable": {
            "Type": "AWS::EC2::RouteTable",
            "Properties": {
                "VpcId": {
                    "Ref": "MyVPC"
                }
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "285e209d-3db2-41f7-b98e-4b92d18ef2f2"
                }
            }
        },
        "PrivateRouteTable": {
            "Type": "AWS::EC2::RouteTable",
            "Properties": {
                "VpcId": {
                    "Ref": "MyVPC"
                }
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "06c247ab-5f40-4c1d-9875-bddb71dee69f"
                }
            }
        },
        "EC2RK08U": {
            "Type": "AWS::EC2::Route",
            "Properties": {
                "RouteTableId": {
                    "Ref": "PublicRouteTable"
                },
                "DestinationCidrBlock": "0.0.0.0/0",
                "GatewayId": {
                    "Ref": "MyIGW"
                }
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "37a78795-3671-4f8f-bef1-317efdc1322a"
                }
            },
            "DependsOn": [
                "MyIGW"
            ]
        },
        "EC2SRTA41PVW": {
            "Type": "AWS::EC2::SubnetRouteTableAssociation",
            "Properties": {
                "RouteTableId": {
                    "Ref": "PublicRouteTable"
                },
                "SubnetId": {
                    "Ref": "PublicSubnet01"
                }
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "54c46c84-8259-48de-b61c-8ea680a711c1"
                }
            }
        },
        "EC2SRTA2LJN5": {
            "Type": "AWS::EC2::SubnetRouteTableAssociation",
            "Properties": {
                "RouteTableId": {
                    "Ref": "PrivateRouteTable"
                },
                "SubnetId": {
                    "Ref": "PrivateSubnet01"
                }
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "ecdadcc0-2ec7-47c3-85e2-7467d28359e3"
                }
            }
        },
        "EC2NatGateway": {
            "Type": "AWS::EC2::NatGateway",
            "Properties": {
                "AllocationId": {
                    "Fn::GetAtt": [
                        "EIP",
                        "AllocationId"
                    ]
                },
                "SubnetId": {
                    "Ref": "PublicSubnet01"
                }
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "001e8e4b-33d3-46e7-95bb-73b2a87a597f"
                }
            },
            "DependsOn": [
                "EIP"
            ]
        },
        "EIP": {
            "Type": "AWS::EC2::EIP",
            "Properties": {
                "Domain": "vpc"
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "f27bd653-e334-4f1e-965a-ef2d9c127891"
                }
            }
        },
        "EC2R2P8YE": {
            "Type": "AWS::EC2::Route",
            "Properties": {
                "RouteTableId": {
                    "Ref": "PrivateRouteTable"
                },
                "DestinationCidrBlock": "0.0.0.0/0",
                "NatGatewayId": {
                    "Ref": "EC2NatGateway"
                }
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "75b61100-5293-402d-9fa2-7cb55e9150db"
                }
            }
        },
        "WebServer01": {
            "Type": "AWS::EC2::Instance",
            "Properties": {
                "ImageId": "ami-0ad42f4f66f6c1cc9",
                "InstanceType": "t2.micro",
                "BlockDeviceMappings": [
                    {
                        "DeviceName": "/dev/sdm",
                        "Ebs": {
                            "VolumeType": "gp2",
                            "DeleteOnTermination": "true",
                            "VolumeSize": "10"
                        }
                    }
                ],
                "SubnetId": {
                    "Ref": "PublicSubnet01"
                },
                "SecurityGroupIds": [
                    {
                        "Ref": "WebServerSecurityGroup"
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "\n",
                            [
                                "#!/bin/bash -xe",
                                "sudo yum update -y",
                                "sudo yum -y install httpd",
                                "sudo service httpd start",
                                "sudo yum -y install php php-mysql",
                                "echo '<h1> Welcome Page 1</h1>' >> /var/www/html/index.html"
                            ]
                        ]
                    }
                }
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "f885cde4-850d-44d8-a878-77b4f4ecd5e5"
                }
            },
            "DependsOn": [
                "PublicSubnet01"
            ]
        },
        "WebServerSecurityGroup": {
            "Type": "AWS::EC2::SecurityGroup",
            "Properties": {
                "GroupDescription": "Security Group for webserver allowing port 22, 80,3389, 443 ",
                "SecurityGroupIngress": [
                    {
                        "IpProtocol": "tcp",
                        "FromPort": 22,
                        "ToPort": 22,
                        "CidrIp": "0.0.0.0/0"
                    },
                    {
                        "IpProtocol": "tcp",
                        "FromPort": 80,
                        "ToPort": 80,
                        "CidrIp": "0.0.0.0/0"
                    },
                    {
                        "IpProtocol": "tcp",
                        "FromPort": 443,
                        "ToPort": 443,
                        "CidrIp": "0.0.0.0/0"
                    },
                    {
                        "IpProtocol": "tcp",
                        "FromPort": 3389,
                        "ToPort": 3389,
                        "CidrIp": "0.0.0.0/0"
                    }
                ],
                "VpcId": {
                    "Ref": "MyVPC"
                }
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "45c34ac4-d6ec-4716-9e23-748e88ffb2bf"
                }
            }
        },
        "WebServer02": {
            "Type": "AWS::EC2::Instance",
            "Properties": {
                "InstanceType": "t2.micro",
                "ImageId": "ami-0ad42f4f66f6c1cc9",
                "SubnetId": {
                    "Ref": "PublicSubnet01"
                },
                "BlockDeviceMappings": [
                    {
                        "DeviceName": "/dev/sdc",
                        "Ebs": {
                            "VolumeType": "gp2",
                            "DeleteOnTermination": "true",
                            "VolumeSize": "10"
                        }
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "\n",
                            [
                                "#!/bin/bash -xe",
                                "sudo yum update -y",
                                "sudo yum -y install httpd",
                                "sudo service httpd start",
                                "sudo yum -y install php php-mysql",
                                "echo '<h1> Welcome Page 1</h1>' >> /var/www/html/index.html"
                            ]
                        ]
                    }
                },
                "InstanceInitiatedShutdownBehavior": "stop",
                "SecurityGroupIds": [
                    {
                        "Ref": "WebServerSecurityGroup"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "321caf8c-1251-4d65-8733-0ad7c8bb5abd"
                }
            },
            "DependsOn": [
                "PublicSubnet01"
            ]
        },
        "ELBSecurityGroup": {
            "Type": "AWS::EC2::SecurityGroup",
            "Properties": {
                "GroupDescription": "Security Group for Load balancer allowing port 80, 443",
                "SecurityGroupIngress": [
                    {
                        "IpProtocol": "tcp",
                        "FromPort": 80,
                        "ToPort": 80,
                        "CidrIp": "0.0.0.0/0"
                    },
                    {
                        "IpProtocol": "tcp",
                        "FromPort": 443,
                        "ToPort": 443,
                        "CidrIp": "0.0.0.0/0"
                    }
                ],
                "VpcId": {
                    "Ref": "MyVPC"
                }
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "7ce06f9a-1f09-4e68-87ab-61f31e80e257"
                }
            }
        },
        "ApplicationLoadBalancer": {
            "Type": "AWS::ElasticLoadBalancing::LoadBalancer",
            "Properties": {
                "Scheme": "internet-facing",
                "Listeners": [
                    {
                        "InstancePort": "80",
                        "InstanceProtocol": "HTTP",
                        "LoadBalancerPort": "80",
                        "Protocol": "HTTP"
                    }
                ],
                "Subnets": [
                    {
                        "Ref": "PublicSubnet01"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "133acb19-2424-4e76-bf3f-20b9d1680c4f"
                }
            },
            "DependsOn": [
                "WebServer01",
                "WebServer02",
                "ELBSecurityGroup"
            ]
        },
        "DataBaseInstance": {
            "Type": "AWS::EC2::Instance",
            "Properties": {
                "SubnetId": {
                    "Ref": "PrivateSubnet01"
                },
                "ImageId": "ami-0ad42f4f66f6c1cc9",
                "InstanceType": "t2.micro",
                "BlockDeviceMappings": [
                    {
                        "DeviceName": "/dev/sdf",
                        "Ebs": {
                            "VolumeType": "gp2",
                            "DeleteOnTermination": "true",
                            "VolumeSize": "10"
                        }
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "\n",
                            [
                                "#!/bin/bash -xe",
                                "sudo yum update -y",
                                "sudo yum -y install mysql-server",
                                "sudo service mysqld start"
                            ]
                        ]
                    }
                },
                "SecurityGroupIds": [
                    {
                        "Ref": "EC2SG2OQG"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "0cde96a3-c773-497e-9e5f-c740e7c05c9f"
                }
            },
            "DependsOn": [
                "PrivateSubnet01"
            ]
        },
        "EC2SG2OQG": {
            "Type": "AWS::EC2::SecurityGroup",
            "Properties": {
                "GroupDescription": "Security Group for DataBaseServer allowing port 80, 443",
                "SecurityGroupIngress": [
                    {
                        "IpProtocol": "tcp",
                        "FromPort": 22,
                        "ToPort": 22,
                        "CidrIp": "0.0.0.0/0"
                    },
                    {
                        "IpProtocol": "tcp",
                        "FromPort": 3389,
                        "ToPort": 3389,
                        "CidrIp": "0.0.0.0/0"
                    },
                    {
                        "IpProtocol": "tcp",
                        "FromPort": 1403,
                        "ToPort": 1403,
                        "CidrIp": "0.0.0.0/0"
                    },
                    {
                        "IpProtocol": "tcp",
                        "FromPort": 3306,
                        "ToPort": 3306,
                        "CidrIp": "0.0.0.0/0"
                    }
                ],
                "VpcId": {
                    "Ref": "MyVPC"
                }
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "d97d199d-9c3c-4db1-b95b-183e518bf3bb"
                }
            }
        }
    }
}